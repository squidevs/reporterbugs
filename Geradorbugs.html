<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate formatted bug</title>
    <!-- Importing CKEditor via CDN -->
    <script src="https://cdn.ckeditor.com/4.20.2/full/ckeditor.js"></script>
    <!-- Importing Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #444444;
            color: #343a40;
        }

        .cke_notification.cke_notification_warning {
            display: none !important;
        }

        .container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-top: 20px;
        }

        h1 {
            color: #ff0000;
            margin-bottom: 20px;
        }

        strong {
            margin-top: 10px;
            display: block;
            color: #495057;
        }

        .form-control {
            border-radius: 4px;
            border: 1px solid #ced4da;
            transition: border-color 0.2s;
        }

        .form-control:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .btn {
            border-radius: 4px;
            margin-top: 10px;
        }

        .btn-info {
            background-color: #b81717;
            color: #FFF;
            border: none;
            border-radius: 24px;
        }

        .btn-info:hover {
            background-color: #690000;
            color: #FFF;
        }

        .btn-success {
            background-color: #28a745;
            border: none;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-secondary {
            background-color: #6c757d;
            border: none;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        #editorDiv {
            margin-top: 20px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
        }

        .impacto-select {
            color: black;
            /* Cor padr√£o */
        }

        .impacto-select option[value="‚ó¨ Critical"] {
            color: red;
        }

        .impacto-select option[value="‚ñ≥ Highest"] {
            color: orange;
        }

        .impacto-select option[value="‚ñ≤ High"] {
            color: gold;
        }

        .impacto-select option[value="‚óÜ Medium"] {
            color: green;
        }

        .impacto-select option[value="‚ñº Low"] {
            color: lightblue;
        }

        .impacto-select option[value="‚ñΩ Lowest"] {
            color: darkblue;
        }
    </style>
</head>

<body>
    <div class="container mt-5" style="width: 60%;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>Generate formatted bug</h1>
            <div>
                <button id="importJsonBtn" class="btn btn-info" style="margin-right: 5px;">Importar JSON</button>
                <button id="downloadTemplateBtn" class="btn btn-info">Template</button>
                <button id="toggleLanguageBtn" class="btn btn-info">EN</button>
                <button id="manualImport" class="btn btn-info">Disable</button>

            </div>
        </div>
        <div style="display: none;">
            <label for="url">Insert image:</label>
            <input type="text" id="url" name="url" class="form-control">
            <button id="insertImageButton" class="btn btn-secondary">Insert</button>
        </div>

        <!-- Form for filling -->
        <form id="formulario" class="mt-4">
            <strong>Title</strong>

            <input type="text" id="titulo" name="titulo" class="form-control">

            <strong>Description</strong>

            <textarea id="descricao" name="descricao" rows="4" class="form-control"></textarea>
            <br>
            <strong>Cine</strong>
            <input type="text" id="cine" name="cine" class="form-control" placeholder="Hoyts Unicenter, etc.">
            <script>
                const cinemaSelect = document.getElementById('cinema');

                // Atualiza a cor ao mudar a sele√ß√£o
                impactoSelect.addEventListener('change', atualizarCorSelect);
            </script>
            <br>
            <br>

            <strong>Ambiente</strong>
            <div class="mb-3">
                <div class="btn-group w-50" role="group">
                    <input type="checkbox" class="btn-check" name="ambiente" id="DEV" autocomplete="off">
                    <label class="btn btn-outline-danger" for="DEV">DEV</label>

                    <input type="checkbox" class="btn-check" name="ambiente" id="QA" autocomplete="off" checked>
                    <label class="btn btn-outline-danger" for="QA">QA</label>

                    <input type="checkbox" class="btn-check" name="ambiente" id="BETA" autocomplete="off">
                    <label class="btn btn-outline-danger" for="BETA">BETA</label>

                    <input type="checkbox" class="btn-check" name="ambiente" id="PROD" autocomplete="off">
                    <label class="btn btn-outline-danger" for="PROD">PROD</label>
                </div>
            </div>

            <strong>User</strong>
            <input type="text" id="user" name="user" class="form-control" placeholder="Enter user">

            <strong>Password</strong>
            <input type="password" id="password" name="password" class="form-control" placeholder="Enter password">

            <strong>Pa√≠s</strong>
            <div class="mb-3">
                <div class="btn-group w-50" role="group">
                    <input type="checkbox" class="btn-check" name="pais" id="AR" autocomplete="off" checked>
                    <label class="btn btn-outline-danger" for="AR">AR</label>

                    <input type="checkbox" class="btn-check" name="pais" id="PE" autocomplete="off">
                    <label class="btn btn-outline-danger red" for="PE">PE</label>

                    <input type="checkbox" class="btn-check" name="pais" id="BO" autocomplete="off">
                    <label class="btn btn-outline-danger red" for="BO">BO</label>

                    <input type="checkbox" class="btn-check" name="pais" id="CO" autocomplete="off">
                    <label class="btn btn-outline-danger red" for="CO">CO</label>

                    <input type="checkbox" class="btn-check" name="pais" id="PY" autocomplete="off">
                    <label class="btn btn-outline-danger red" for="PY">PY</label>
                    <input type="checkbox" class="btn-check" name="pais" id="CL" autocomplete="off">
                    <label class="btn btn-outline-danger red" for="CL">CL</label>

                    <input type="checkbox" class="btn-check" name="pais" id="LATAM" autocomplete="off">
                    <label class="btn btn-outline-danger red" for="LATAM">LATAM</label>
                </div>
            </div>

            <h6>Breakpoint</h6>
            <div class="mb-3">
                <div class="btn-group w-50" role="group">
                    <input type="checkbox" class="btn-check" name="breakpoint" id="DESKTOP (1280px)" autocomplete="off"
                        checked>
                    <label class="btn btn-outline-danger" for="DESKTOP (1280px)">DESKTOP (1280px)</label>

                    <input type="checkbox" class="btn-check" name="breakpoint" id="MOBILE (360px)" autocomplete="off">
                    <label class="btn btn-outline-danger" for="MOBILE (360px)">MOBILE (360px)</label>
                </div>
            </div>

            <strong>Prerequisites</strong>

            <textarea id="preRequisitos" name="preRequisitos" rows="2" class="form-control"></textarea>

            <h6>Steps to reproduce</h6>
            <div class="mt-2 mb-2">
                <button id="dadoQueButton" class="btn btn-info">GIVEN</button>
                <button id="eButton" class="btn btn-info">AND</button>
                <button id="ouButton" class="btn btn-info">OR</button>
                <button id="quandoButton" class="btn btn-info">WHEN</button>
                <button id="entaoButton" class="btn btn-info">THEN</button>
            </div>

            <textarea id="passosTextarea" rows="4" class="form-control"></textarea>
            <br>

            <strong>Obtained result</strong>

            <textarea id="resultadoObtido" name="resultadoObtido" rows="2" class="form-control"></textarea>

            <strong>Expected result</strong>

            <textarea id="resultadoEsperado" name="resultadoEsperado" rows="2" class="form-control"></textarea>

            <strong>Evidence(s)</strong>

            <textarea id="evidencias" name="evidencias" rows="2" class="form-control"></textarea>

            <button onclick="location.href='#editorDiv'" type="submit" id="gerarButton" class="btn btn-success"><i
                    class="bi bi-hammer"></i>
                Generate</button>
        </form>
        <!-- Text Editor -->
        <br>
        <div id="editorDiv" style="display: none">
            <textarea id="editor" name="editor" rows="30" cols="80" class="form-control"></textarea>
            <!-- Button to copy HTML -->
            <button id="copyButton" class="btn btn-primary">Copy</button>
            <br>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const warningNotification = document.querySelector('.cke_notification.cke_notification_warning');
            if (warningNotification) {
                warningNotification.style.display = 'none';
            }
        });


        let currentLanguage = 'pt'; // Idioma padr√£o para portugu√™s

        // Fun√ß√£o para alternar o idioma
        document.getElementById('toggleLanguageBtn').addEventListener('click', function () {
            currentLanguage = currentLanguage === 'en' ? 'pt' : 'en'; // Alterna entre pt e en
            this.textContent = currentLanguage === 'en' ? 'PTBR' : 'EN'; // Atualiza o texto do bot√£o
        });

        // Fun√ß√£o para desativar a API de tradu√ß√£o autom√°tica
        let translationEnabled = true; // Controle para ativar/desativar a tradu√ß√£o

        document.getElementById('manualImport').addEventListener('click', function () {
            translationEnabled = !translationEnabled; // Alterna entre ativado e desativado
            this.textContent = translationEnabled ? 'Disable' : 'Enable'; // Atualiza o texto do bot√£o
        });

        // Initializing CKEditor
        CKEDITOR.replace('editor');

        // Function to copy the generated HTML
        document.getElementById('copyButton').addEventListener('click', function () {
            // Get the CKEditor iframe
            const editorFrame = document.querySelector('#cke_editor iframe');
            if (editorFrame) {
                const editorWindow = editorFrame.contentWindow;
                const editorDocument = editorWindow.document;

                // Create a range and selection
                const range = editorDocument.createRange();
                range.selectNodeContents(editorDocument.body);

                const selection = editorWindow.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);

                // Execute copy command
                try {
                    editorDocument.execCommand('copy');
                    alert('Content copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy:', err);
                    alert('Failed to copy content');
                }

                // Clear selection
                selection.removeAllRanges();
            }
        });

        // API call to translate the content
        const translateContent = async (content) => {
            const langPair = currentLanguage === 'en' ? 'en|pt' : 'pt|en'; // Define o par de idiomas
            try {
                const response = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(content)}&langpair=${langPair}`);
                if (!response.ok) {
                    throw new Error('Error in API response');
                }
                const data = await response.json();
                return data.responseData.translatedText;
            } catch (error) {
                console.error('Translation error:', error);
                return content; // Retorna o conte√∫do original em caso de erro
            }
        };

        const delay = ms => new Promise(resolve => setTimeout(resolve, ms));

        // Function to send the form to the editor
        document.getElementById('formulario').addEventListener('submit', async function (event) {
            event.preventDefault(); // Evita o envio padr√£o do formul√°rio

            // Captura os valores diretamente dos campos
            const titulo = document.getElementById('titulo').value.trim() || '[no text]';
            const descricao = document.getElementById('descricao').value.trim() || '[no text]';
            const ambiente = Array.from(document.querySelectorAll('input[name="ambiente"]:checked'))
                .map(input => input.id).join(', ') || '[no text]';
            const pais = Array.from(document.querySelectorAll('input[name="pais"]:checked'))
                .map(input => input.id).join(', ') || '[no text]';
            const cine = document.getElementById('cine').value.trim() || '[no text]';
            const user = document.getElementById('user').value.trim() || '[no text]';
            const password = document.getElementById('password').value.trim() || '[no text]';
            const passos = document.getElementById('passosTextarea').value.trim() || '[no text]';
            const preRequisitos = document.getElementById('preRequisitos').value.trim() || '[no text]';
            const resultadoObtido = document.getElementById('resultadoObtido').value.trim() || '[no text]';
            const resultadoEsperado = document.getElementById('resultadoEsperado').value.trim() || '[no text]';
            const evidencias = document.getElementById('evidencias').value.trim() || '[no text]';
            const breakpoints = Array.from(document.querySelectorAll('input[name="breakpoint"]:checked'))
                .map(input => input.id).join(', ') || '[no text]';

            // Se a tradu√ß√£o estiver habilitada, traduz os campos
            const translatedTitulo = translationEnabled ? await translateContent(titulo) : titulo;
            const translatedDescricao = translationEnabled ? await translateContent(descricao) : descricao;
            const translatedPassos = translationEnabled ? await translateContent(passos) : passos;
            const translatedPreRequisitos = translationEnabled ? await translateContent(preRequisitos) : preRequisitos;
            const translatedResultadoObtido = translationEnabled ? await translateContent(resultadoObtido) : resultadoObtido;
            const translatedResultadoEsperado = translationEnabled ? await translateContent(resultadoEsperado) : resultadoEsperado;
            const translatedEvidencias = translationEnabled ? await translateContent(evidencias) : evidencias;

            // Gera o conte√∫do traduzido ou original
            const translatedContent = `
        <h1>${translatedTitulo}</h1>
        <hr>
        <table border="none" cellspacing="1" style="border-collapse:collapse; text-align:left; width:80%">
            <tbody>
                <tr>
                    <td style="vertical-align: top;">
                        <strong>DESCRIPTION:</strong><br />${translatedDescricao}
                        <br><br>
                        <strong>üñ•Ô∏èENVIRONMENT:</strong> ${ambiente}
                        <br>
                        <strong>üë§USER:</strong> ${user}
                        <br>
                        <strong>üîíPASSWORD:</strong> ${password}
                        <br>
                        <strong>üåéCOUNTRY:</strong><br>
                        ${(() => {
                            let paises = pais.split(', ');
                            return paises.map(p => {
                                if (p === 'LATAM') {
                                    return `${p}`;
                                }
                                return `<img src="https://flagpedia.net/data/flags/h20/${p.toLowerCase()}.webp" alt="${p}" style="margin-right: 5px;"> ${p}`;
                            }).join('<br>');
                        })()}
                        <br>
                        <strong>üé•CINE:</strong> ${cine}
                        <br>
                        <strong>üì±BREAKPOINT:</strong> ${breakpoints}
                        <br>
                        <strong>üõ†Ô∏èPREREQUISITES:</strong><br />${translatedPreRequisitos}
                        <br>
                        <strong>üë£STEPS:</strong><br />${translatedPassos.replace(/^(AND|OR|WHEN|THEN)/gm, '<br>$1')}
                        <br>
                        <strong>üéØEXPECTED RESULT:</strong><br />${translatedResultadoEsperado}
                        <br>
                        <strong>üß©RESULT OBTAINED:</strong><br />${translatedResultadoObtido}
                        <br>
                        <strong>üñºÔ∏èEVIDENCE(S):</strong><br />${translatedEvidencias}
                    </td>
                </tr>
            </tbody>
        </table>
        <p>&nbsp;</p>
    `;

            // Envia o conte√∫do para o CKEditor
            CKEDITOR.instances.editor.setData(translatedContent);
        });

        // Function to add text to the textarea
        function adicionarTexto(texto) {
            const textarea = document.getElementById('passosTextarea');
            if (texto === 'GIVEN') {
                textarea.value += texto + '\n'; // Adiciona "GIVEN" sem <br>
            } else {
                textarea.value += texto + '\n'; // Adiciona <br> antes dos outros passos
            }
        }

        // Adding events to the buttons
        document.getElementById('dadoQueButton').addEventListener('click', function () {
            adicionarTexto('GIVEN');
        });
        document.getElementById('eButton').addEventListener('click', function () {
            adicionarTexto('AND');
        });
        document.getElementById('ouButton').addEventListener('click', function () {
            adicionarTexto('OR');
        });
        document.getElementById('quandoButton').addEventListener('click', function () {
            adicionarTexto('WHEN');
        });
        document.getElementById('entaoButton').addEventListener('click', function () {
            adicionarTexto('THEN');
        });

        // Function to display the editor
        document.getElementById('gerarButton').addEventListener('click', function () {
            document.getElementById('editorDiv').style.display = 'block'; // Displays the editor
        });

        document.getElementById('importJsonBtn').addEventListener('click', function () {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = readerEvent => {
                    try {
                        const content = readerEvent.target.result;
                        const jsonData = JSON.parse(content);

                        // Preenchendo os campos do formul√°rio com os dados do JSON
                        document.getElementById('titulo').value = jsonData.titulo || '';
                        document.getElementById('descricao').value = jsonData.descricao || '';
                        document.getElementById('cine').value = jsonData.cine || '';
                        document.getElementById('user').value = jsonData.user || '';
                        document.getElementById('password').value = jsonData.password || '';
                        document.getElementById('preRequisitos').value = jsonData.preRequisitos || '';
                        document.getElementById('resultadoObtido').value = jsonData.resultadoObtido || '';
                        document.getElementById('resultadoEsperado').value = jsonData.resultadoEsperado || '';
                        document.getElementById('evidencias').value = jsonData.evidencias || '';
                        // Garantir que todos os checkboxes sejam preenchidos corretamente
                        const ambienteCheckboxesImport = document.querySelectorAll('input[name="ambiente"]');
                        ambienteCheckboxesImport.forEach(checkbox => {
                            checkbox.checked = Array.isArray(jsonData.ambiente) && jsonData.ambiente.includes(checkbox.id);
                        });
                        const paisCheckboxesImport = document.querySelectorAll('input[name="pais"]');
                        paisCheckboxesImport.forEach(checkbox => {
                            checkbox.checked = Array.isArray(jsonData.pais) && jsonData.pais.includes(checkbox.id);
                        });
                        const breakpointsCheckboxesImport = document.querySelectorAll('input[name="breakpoint"]');
                        breakpointsCheckboxesImport.forEach(checkbox => {
                            checkbox.checked = Array.isArray(jsonData.breakpoints) && jsonData.breakpoints.includes(checkbox.id);
                        });
                        // Passos
                        const passosTextareaImport = document.getElementById('passosTextarea');
                        if (Array.isArray(jsonData.passos)) {
                            passosTextareaImport.value = jsonData.passos.join('\n');
                        } else if (typeof jsonData.passos === 'string') {
                            passosTextareaImport.value = jsonData.passos;
                        } else {
                            passosTextareaImport.value = '';
                        }

                        // Preenchendo o campo de ambiente
                        const ambienteCheckboxes = document.querySelectorAll('input[name="ambiente"]');
                        ambienteCheckboxes.forEach(checkbox => {
                            checkbox.checked = jsonData.ambiente && jsonData.ambiente.includes(checkbox.id);
                        });

                        // Preenchendo o campo de pa√≠s
                        const paisCheckboxes = document.querySelectorAll('input[name="pais"]');
                        paisCheckboxes.forEach(checkbox => {
                            checkbox.checked = jsonData.pais && jsonData.pais.includes(checkbox.id);
                        });

                        // Preenchendo o campo de breakpoints
                        const breakpointsCheckboxes = document.querySelectorAll('input[name="breakpoint"]');
                        breakpointsCheckboxes.forEach(checkbox => {
                            checkbox.checked = jsonData.breakpoints && jsonData.breakpoints.includes(checkbox.id);
                        });

                        // Preenchendo os passos
                        const passosTextarea = document.getElementById('passosTextarea');
                        passosTextarea.value = jsonData.passos ? jsonData.passos.join('\n') : '';

                        // Aviso de sucesso
                        alert('Arquivo JSON importado com sucesso!');
                    } catch (error) {
                        console.error('Erro ao importar o JSON:', error);
                        alert('Erro ao importar o arquivo JSON. Verifique o formato do arquivo.');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        });

        // Verifica se a p√°gina j√° foi recarregada
        if (!sessionStorage.getItem('reloaded')) {
            sessionStorage.setItem('reloaded', 'true'); // Marca que a p√°gina foi recarregada
            location.reload(true); // Recarrega a p√°gina sem usar o cache
        } else {
            sessionStorage.removeItem('reloaded'); // Remove a marca ap√≥s o recarregamento
        }

        // Fun√ß√£o para baixar o template JSON
        document.getElementById('downloadTemplateBtn').addEventListener('click', function () {
            const template = {
                titulo: "Seu titulo",
                descricao: "Sua descri√ß√£o",
                impacto: "‚óÜ Medium",
                Dica: "Op√ß√µes, escolha apenas 1 para preencher o impacto."
                    + "‚ó¨ Critical"
                    + "‚ñ≥ Highest"
                    + "‚ñ≤ High"
                    + "‚óÜ Medium"
                    + "‚ñº Low"
                    + "‚ñΩ Lowest",
                cine: "Hoyts Unicenter",
                resultadoObtido: "Hoyts Unicenter",
                user: "poppix@gmail.com",
                password: "p3p4p4p3",
                preRequisitos: "Pre requisitos",
                resultadoObtido: "Obtido",
                resultadoEsperado: "Esperado",
                ambiente: [
                    "DEV",
                    "QA", // Atualizado para refletir os checkboxes
                    "BETA",
                    "PROD"
                ],
                evidencias: "",
                pais: [
                    "AR",
                    "PE",
                    "BO",
                    "CO",
                    "PY",
                    "CL" // Atualizado para refletir os checkboxes
                ],
                breakpoints: [
                    "DESKTOP (1280px)", // Atualizado para refletir os checkboxes
                    "MOBILE (360px)" // Atualizado para refletir os checkboxes
                ],
                passos: [
                    "GIVEN ",
                    "AND ",
                    "OR ",
                    "WHEN ",
                    "THEN "
                ]
            };

            const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'template_importacao_tarefas.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
    </script>
</body>

</html>