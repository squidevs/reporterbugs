<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Item Generation Assistant</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Estilos do projeto aplicados -->
    <link rel="stylesheet" href="styles/globais.css">
    <link rel="stylesheet" href="styles/desktop.css">
    <link rel="stylesheet" href="styles/mobile.css">
    <link rel="stylesheet" href="styles/temas.css">
    <link rel="stylesheet" href="styles/styles.css">

</head>

<body>
    <!-- Conteúdo Principal -->
    <main class="conteudo-principal p-4">
        <div class="container-fluid" style="max-width: 1200px;">
            <!-- Page Header -->
            <div class="page-header text-center">
                <h1><i class="bi bi-hammer me-2"></i>Work Item Generation Assistant</h1>
                <p class="mb-0 mt-2 opacity-90">Fill in the fields below to generate a formatted work item</p>
            </div>

            <!-- Form -->
            <form id="formulario" novalidate>
                <!-- Steps Accordion -->
                <div class="accordion" id="accordionEtapas">
                    <!-- Step 1: Basic Information -->
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingInfoBasicas">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseInfoBasicas" aria-expanded="true"
                                aria-controls="collapseInfoBasicas">
                                <i class=" me-2"></i>Step 1: Basic Information
                            </button>
                        </h2>
                        <div id="collapseInfoBasicas" class="accordion-collapse collapse show"
                            aria-labelledby="headingInfoBasicas" data-bs-parent="#accordionEtapas">
                            <div class="accordion-body">

                                <div class="mb-4">
                                    <div class="mb-4">
                                        <label class="form-label" for="demandSource">
                                            Will this demand be returned directly by the service or come from
                                            Backoffice? <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Select the service layer(s) involved (multiple selection allowed)."></i>
                                        </label>
                                        <div class="btn-toggle-group" role="group" id="demandSourceGroup">
                                            <input type="checkbox" class="btn-check" name="demandSource" id="NextSolutions"
                                                value="NextSolutions" autocomplete="off">
                                            <label class="btn btn-outline-primary" for="NextSolutions">NextSolutions</label>
                                            <input type="checkbox" class="btn-check" name="demandSource" id="SunDevs"
                                                value="SunDevs" autocomplete="off">
                                            <label class="btn btn-outline-primary" for="SunDevs">SunDevs</label>
                                            <input type="checkbox" class="btn-check" name="demandSource" id="LênioLabs"
                                                value="LênioLabs" autocomplete="off">
                                            <label class="btn btn-outline-primary" for="LênioLabs">LênioLabs</label>
                                            <input type="checkbox" class="btn-check" name="demandSource" id="BackOffice"
                                                value="BackOffice" autocomplete="off">
                                            <label class="btn btn-outline-primary" for="BackOffice">BackOffice</label>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="backendDocAvailable">
                                            Backend documentation already available?
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Indicate if the backend documentation is already available."></i>
                                        </label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch"
                                                id="backendDocAvailable" name="backendDocAvailable">
                                            <label class="form-check-label" for="backendDocAvailable">
                                                <span id="backendDocAvailableLabel">No</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-4" id="backendDocUrlContainer" style="display: none;">
                                        <label class="form-label" for="backendDocUrl">
                                            Enter URL/Link to document (Azure Wiki or other) <span
                                                class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Enter the URL or link to the backend documentation."></i>
                                        </label>
                                        <input type="url" id="backendDocUrl" name="backendDocUrl" class="form-control"
                                            placeholder="https://dev.azure.com/... or https://wiki.example.com/...">
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="titulo">
                                            Title <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Enter a clear and objective title for the work item."></i>
                                        </label>
                                        <input type="text" id="titulo" name="titulo" class="form-control"
                                            placeholder="Enter the work item title...">
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label" for="solicitante">
                                            Reported by <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Enter your name"></i>
                                        </label>
                                        <input type="text" id="nome" name="nome" class="form-control"
                                            placeholder="Enter your name...">
                                    </div>


                                    <label class="form-label" for="country">
                                        Select country <span class="badge-required">*</span>
                                        <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                            title="Select the country(ies) involved in the work item."></i>
                                    </label>
                                    <div class="btn-toggle-group" role="group" id="countryGroup">
                                        <input type="checkbox" class="btn-check" name="country" id="LT" value="LT"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger btn-pais" for="LT">
                                            <img src="https://img1.gratispng.com/20181206/up/kisspng-flags-of-south-america-latin-america-united-states-americalatina-en-taringa-1713912771812.webp"
                                                alt="LT" onerror="this.style.display='none'">
                                            LT
                                        </label>
                                        <input type="checkbox" class="btn-check" name="country" id="AR" value="AR"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger btn-pais" for="AR">
                                            <img src="https://flagpedia.net/data/flags/h20/ar.webp" alt="AR"
                                                onerror="this.style.display='none'">
                                            AR
                                        </label>
                                        <input type="checkbox" class="btn-check" name="country" id="BO" value="BO"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger btn-pais" for="BO">
                                            <img src="https://flagpedia.net/data/flags/h20/bo.webp" alt="BO"
                                                onerror="this.style.display='none'">
                                            BO
                                        </label>
                                        <input type="checkbox" class="btn-check" name="country" id="CL" value="CL"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger btn-pais" for="CL">
                                            <img src="https://flagpedia.net/data/flags/h20/cl.webp" alt="CL"
                                                onerror="this.style.display='none'">
                                            CL
                                        </label>
                                        <input type="checkbox" class="btn-check" name="country" id="PE" value="PE"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger btn-pais" for="PE">
                                            <img src="https://flagpedia.net/data/flags/h20/pe.webp" alt="PE"
                                                onerror="this.style.display='none'">
                                            PE
                                        </label>
                                        <input type="checkbox" class="btn-check" name="country" id="PY" value="PY"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger btn-pais" for="PY">
                                            <img src="https://flagpedia.net/data/flags/h20/py.webp" alt="PY"
                                                onerror="this.style.display='none'">
                                            PY
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-4">
                                    <label class="form-label" for="featureModalBtn">
                                        Select Feature/Page <span class="badge-required">*</span>
                                        <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                            title="Select the main feature or page for the work item. Click the button to open the complete list."></i>
                                    </label>
                                    <button type="button"
                                        class="btn btn-outline-secondary w-100 text-start d-flex justify-content-between align-items-center"
                                        id="featureModalBtn" data-bs-toggle="modal" data-bs-target="#featureModal">
                                        <span id="featureSelectedDisplay">
                                            <span class="text-muted">Select one feature...</span>
                                        </span>
                                        <i class="bi bi-chevron-right"></i>
                                    </button>
                                    <input type="hidden" id="featureSelectedValue" name="featureSelectedValue">
                                </div>
                                <div class="mb-4">
                                    <label class="form-label" for="relatedFeaturesModalBtn">
                                        Related Features/Pages
                                        <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                            title="Select related features or pages (multiple selection allowed). Click the button to open the complete list."></i>
                                    </label>
                                    <button type="button"
                                        class="btn btn-outline-secondary w-100 text-start d-flex justify-content-between align-items-center"
                                        id="relatedFeaturesModalBtn" data-bs-toggle="modal"
                                        data-bs-target="#relatedFeaturesModal">
                                        <span id="relatedFeaturesSelectedDisplay">
                                            <span class="text-muted">Select related features...</span>
                                        </span>
                                        <i class="bi bi-chevron-right"></i>
                                    </button>
                                    <input type="hidden" id="relatedFeaturesSelectedValues"
                                        name="relatedFeaturesSelectedValues">
                                </div>

                                <div class="mb-4">
                                    <label class="form-label" for="workitem">
                                        Select Work Item <span class="badge-required">*</span>
                                        <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                            title="Choose if the work item is a BUG or a User Story (or feature)"></i>
                                    </label>
                                    <div class="btn-toggle-group" role="group" id="workitemGroup">
                                        <input type="radio" class="btn-check" name="workitem" id="BUG"
                                            autocomplete="off">
                                        <label class="btn btn-outline-danger" for="BUG"><i
                                                class="bi bi-bug-fill me-1"></i>BUG</label>
                                        <input type="radio" class="btn-check" name="workitem" id="UserStory"
                                            autocomplete="off">
                                        <label class="btn btn-outline-primary" for="UserStory"><i
                                                class="bi bi-file-text me-1"></i>User Story (or feature)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Bug Details -->
                    <div class="accordion-item" id="accordionItemBug" style="display: none;">
                        <h2 class="accordion-header" id="headingBug">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseBug" aria-expanded="false" aria-controls="collapseBug">
                                <i class="bi bi-bug-fill me-2"></i>Step 2: Bug Details
                            </button>
                        </h2>
                        <div id="collapseBug" class="accordion-collapse collapse" aria-labelledby="headingBug"
                            data-bs-parent="#accordionEtapas">
                            <div class="accordion-body">
                                <div id="bugFields">

                                    <div class="mb-4">
                                        <label class="form-label" for="env">
                                            Select environment <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Select the environment(s) where the bug occurs."></i>
                                        </label>
                                        <div class="btn-toggle-group" role="group" id="envGroup">
                                            <input type="checkbox" class="btn-check" name="env" id="QA" value="QA"
                                                autocomplete="off">
                                            <label class="btn btn-outline-danger" for="QA"><i
                                                    class="bi bi-bug me-1"></i>QA</label>
                                            <input type="checkbox" class="btn-check" name="env" id="BETA" value="BETA"
                                                autocomplete="off">
                                            <label class="btn btn-outline-danger" for="BETA"><i
                                                    class="bi bi-layers me-1"></i>BETA</label>
                                            <input type="checkbox" class="btn-check" name="env" id="PROD" value="PROD"
                                                autocomplete="off">
                                            <label class="btn btn-outline-danger" for="PROD"><i
                                                    class="bi bi-globe me-1"></i>PROD</label>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="prodRepro">
                                            Possible reproduce in PROD?
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Indicate if the bug can be reproduced in production."></i>
                                        </label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch" id="prodRepro"
                                                name="prodRepro">
                                            <label class="form-check-label" for="prodRepro">
                                                <span id="prodReproLabel">No</span>
                                            </label>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="context">
                                            Context <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Describe the context in which the bug occurs."></i>
                                        </label>
                                        <textarea id="context" name="context" rows="3" class="form-control"
                                            placeholder="Describe the context..."></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="reproSteps">
                                            Repro Steps to reproduction <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="List the steps to reproduce the bug."></i>
                                        </label>
                                        <textarea id="reproSteps" name="reproSteps" rows="4" class="form-control"
                                            placeholder="1. Step one&#10;2. Step two&#10;3. Step three"></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="breakpoint">
                                            Select Breakpoint (optional)
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Select the affected breakpoint(s), if applicable."></i>
                                        </label>
                                        <div class="btn-group-flex" role="group" id="breakpointGroup">
                                            <input type="checkbox" class="btn-check" name="breakpoint" id="1280px"
                                                autocomplete="off">
                                            <label class="btn btn-outline-secondary" for="1280px">1280px</label>
                                            <input type="checkbox" class="btn-check" name="breakpoint" id="360px"
                                                autocomplete="off">
                                            <label class="btn btn-outline-secondary" for="360px">360px</label>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6 mb-4">
                                            <label class="form-label" for="cine">
                                                Cinema (optional)
                                                <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                    title="Enter the cinema involved, if applicable."></i>
                                            </label>
                                            <input type="text" id="cine" name="cine" class="form-control"
                                                placeholder="Hoyts Unicenter, etc.">
                                        </div>
                                        <div class="col-md-6 mb-4">
                                            <label class="form-label" for="user">
                                                User <span class="badge-required">*</span>
                                                <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                    title="User used for login and testing."></i>
                                            </label>
                                            <input type="text" id="user" name="user" class="form-control"
                                                placeholder="user@example.com">
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="password">
                                            Password <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="User password for login."></i>
                                        </label>
                                        <input type="password" id="password" name="password" class="form-control"
                                            placeholder="••••••••">
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="userType">
                                            Select User type <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Select the user type(s) involved in the test."></i>
                                        </label>
                                        <div class="btn-group-flex" role="group" id="userTypeGroup">
                                            <input type="checkbox" class="btn-check" name="userType" id="Comum"
                                                autocomplete="off">
                                            <label class="btn btn-outline-dark btn-user-type" for="Comum">
                                                <img src="https://i.ibb.co/tTSF48b7/Captura-de-tela-2025-09-25-135916-removebg-preview.png"
                                                    alt="Comum" onerror="this.style.display='none'">
                                                Comum
                                            </label>
                                            <input type="checkbox" class="btn-check" name="userType"
                                                id="cine fan or club" autocomplete="off">
                                            <label class="btn btn-outline-dark btn-user-type" for="cine fan or club">
                                                <img src="https://i.ibb.co/TML2xPsS/Captura-de-tela-2025-09-25-135828-removebg-preview.png"
                                                    alt="Cine Fan/Club" onerror="this.style.display='none'">
                                                Cine Fan/Club
                                            </label>
                                            <input type="checkbox" class="btn-check" name="userType"
                                                id="cine fan or club plus" autocomplete="off">
                                            <label class="btn btn-outline-dark btn-user-type"
                                                for="cine fan or club plus">
                                                <img src="https://i.ibb.co/99jF8Yzb/Captura-de-tela-2025-09-25-135820-removebg-preview.png"
                                                    alt="Cine Fan/Club Plus" onerror="this.style.display='none'">
                                                Cine Fan/Club Plus
                                            </label>
                                            <input type="checkbox" class="btn-check" name="userType"
                                                id="cine fan or club black" autocomplete="off">
                                            <label class="btn btn-outline-dark btn-user-type"
                                                for="cine fan or club black">
                                                <img src="https://i.ibb.co/zV5L6gQy/Captura-de-tela-2025-09-25-135813-removebg-preview.png"
                                                    alt="Cine Fan/Club Black" onerror="this.style.display='none'">
                                                Cine Fan/Club Black
                                            </label>
                                            <input type="checkbox" class="btn-check" name="userType" id="employee"
                                                autocomplete="off">
                                            <label class="btn btn-outline-dark" for="employee">Employee</label>
                                            <input type="checkbox" class="btn-check" name="userType" id="YPF"
                                                autocomplete="off">
                                            <label class="btn btn-outline-dark" for="YPF">YPF</label>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="businessRule">
                                            Business rule And expected solution <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Describe the business rule and expected solution for the request."></i>
                                        </label>
                                        <textarea id="businessRule" name="businessRule" rows="4" class="form-control"
                                            placeholder="Describe the business rule and expected solution..."></textarea>
                                    </div>
                                    <div class="mb-4">
                                        <label class="form-label" for="linkFigma">
                                            Link Figma (optional)
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Enter the Figma link, if available."></i>
                                        </label>
                                        <input type="text" id="linkFigma" name="linkFigma" class="form-control"
                                            placeholder="https://figma.com/...">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: User Story Details -->
                    <div class="accordion-item" id="accordionItemUserStory" style="display: none;">
                        <h2 class="accordion-header" id="headingUserStory">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseUserStory" aria-expanded="false"
                                aria-controls="collapseUserStory">
                                <i class="bi bi-file-text me-2"></i>Step 2: User Story Details
                            </button>
                        </h2>
                        <div id="collapseUserStory" class="accordion-collapse collapse"
                            aria-labelledby="headingUserStory" data-bs-parent="#accordionEtapas">
                            <div class="accordion-body">
                                <div id="userStoryFields">

                                    <div class="mb-4">
                                        <label class="form-label" for="presidentApproval">
                                            Has this demand already been validated and approved by the President or the
                                            responsible Marketing sector?
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Indicate if the demand has already been validated and approved."></i>
                                        </label>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" role="switch"
                                                id="presidentApproval" name="presidentApproval">
                                            <label class="form-check-label" for="presidentApproval">
                                                <span id="presidentApprovalLabel">No</span>
                                            </label>
                                        </div>
                                        <div id="presidentApprovalMessage" class="alert alert-warning mt-2"
                                            style="display: none;">
                                            <i class="bi bi-exclamation-triangle me-2"></i>We will need to wait for
                                            approval or a feasibility assessment from the responsible party before
                                            proceeding.
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="typeDemand">
                                            Type of Demand <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Select the type of demand: new feature, improvement, adjustment or refactoring."></i>
                                        </label>
                                        <div class="btn-toggle-group" role="group" id="typeDemandGroup">
                                            <input type="radio" class="btn-check" name="typeDemand" id="new feature"
                                                value="new feature" autocomplete="off">
                                            <label class="btn btn-outline-info" for="new feature">New Feature</label>
                                            <input type="radio" class="btn-check" name="typeDemand" id="Improvment"
                                                value="Improvment" autocomplete="off">
                                            <label class="btn btn-outline-info" for="Improvment">Improvement</label>
                                            <input type="radio" class="btn-check" name="typeDemand" id="Adjustment"
                                                value="Adjustment" autocomplete="off">
                                            <label class="btn btn-outline-info" for="Adjustment">Adjustment</label>
                                            <input type="radio" class="btn-check" name="typeDemand" id="Refact"
                                                value="Refact" autocomplete="off">
                                            <label class="btn btn-outline-info" for="Refact">Refactoring</label>
                                        </div>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="asA">
                                            As a... <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="The work item will be to solve the problem of which type of user"></i>
                                        </label>
                                        <textarea id="asA" name="asA" rows="3" class="form-control"
                                            placeholder="Ex: The work item will be to solve the problem of which type of user"></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="iWant">
                                            I Want... <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="What do you want to be done?"></i>
                                        </label>
                                        <textarea id="iWant" name="iWant" rows="3" class="form-control"
                                            placeholder="Ex: I want to be able to..."></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="soThat">
                                            So that... <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="What is the objective or expected behavior for this solution"></i>
                                        </label>
                                        <textarea id="soThat" name="soThat" rows="3" class="form-control"
                                            placeholder="What is the objective or expected behavior for this solution"></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="contextUS">
                                            Contextualize your demand <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Explain the context of this work item if it has correlation with any flow, demand, scenario or specific user to facilitate understanding of what needs to be done"></i>
                                        </label>
                                        <textarea id="contextUS" name="contextUS" rows="4" class="form-control"
                                            placeholder="Explain the context of this work item if it has correlation with any flow, demand, scenario or specific user to facilitate understanding of what needs to be done"></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="businessRuleUS">
                                            Business rule And expected solution <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Describe the business rule and expected solution for the request."></i>
                                        </label>
                                        <textarea id="businessRuleUS" name="businessRuleUS" rows="4"
                                            class="form-control"
                                            placeholder="Describe the business rule and expected solution for the request."></textarea>
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="linkFigmaUS">
                                            Link Figma (optional)
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="Enter the Figma link, if available."></i>
                                        </label>
                                        <input type="text" id="linkFigmaUS" name="linkFigmaUS" class="form-control"
                                            placeholder="https://figma.com/...">
                                    </div>

                                    <div class="mb-4">
                                        <label class="form-label" for="criteriosAceite">
                                            Acceptance Criteria <span class="badge-required">*</span>
                                            <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip"
                                                title="List the acceptance criteria for the request. Can be in BDD format."></i>
                                        </label>
                                        <textarea id="criteriosAceite" name="criteriosAceite" rows="4"
                                            class="form-control"
                                            placeholder="Ex:&#10;Given that...&#10;When...&#10;Then..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Formatted Result -->
                    <div class="accordion-item" id="accordionItemResultado" style="display: none;">
                        <h2 class="accordion-header" id="headingResultado">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#collapseResultado" aria-expanded="false"
                                aria-controls="collapseResultado">
                                <i class="bi bi-file-text me-2"></i>Step 3: Formatted Result
                            </button>
                        </h2>
                        <div id="collapseResultado" class="accordion-collapse collapse"
                            aria-labelledby="headingResultado" data-bs-parent="#accordionEtapas">
                            <div class="accordion-body">
                                <div id="resultadoDiv">
                                    <div class="resultado-box">
                                        <button id="copyButton" class="btn btn-primary btn-copiar">
                                            <i class="bi bi-clipboard me-1"></i>Copy
                                        </button>
                                        <textarea id="resultado" name="resultado"
                                            class="form-control resultado-textarea"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Steps Accordion -->

                <!-- Generate Button -->
                <div class="form-section text-center">
                    <button type="submit" id="gerarButton" class="btn btn-success btn-lg px-5">
                        <i class="bi bi-hammer me-2"></i>Generate Work Item
                    </button>
                    <button type="button" id="clearButton" class="btn btn-warning btn-lg px-5" style="display: none;">
                        <i class="bi bi-arrow-clockwise me-2"></i>Clear Form
                    </button>

                    <!-- Pending Fields List -->
                    <div id="pendenciasBox" class="pendencias-box">
                        <h5><i class="bi bi-exclamation-triangle me-2"></i>Pending Fields:</h5>
                        <ul id="pendenciasLista"></ul>
                    </div>
                </div>
            </form>
        </div>
    </main>

    <!-- Copy Alert -->
    <div class="alert alert-success alert-copiado" role="alert">
        <i class="bi bi-check-circle me-2"></i>Text copied successfully!
    </div>

    <!-- Modal for Feature Selection (Single) -->
    <div class="modal fade" id="featureModal" tabindex="-1" aria-labelledby="featureModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="featureModalLabel">
                        <i class="bi bi-list-check me-2"></i>Select Feature/Page
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="featureModalSearch" class="form-control" placeholder="Search features...">
                    <div id="featureModalOptions" class="modal-options-container"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="featureModalConfirm">
                        <i class="bi bi-check-lg me-1"></i>Confirm Selection
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for Related Features (Multi) -->
    <div class="modal fade" id="relatedFeaturesModal" tabindex="-1" aria-labelledby="relatedFeaturesModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="relatedFeaturesModalLabel">
                        <i class="bi bi-list-check me-2"></i>Select Related Features/Pages
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="relatedFeaturesModalSearch" class="form-control"
                        placeholder="Search features...">
                    <div id="relatedFeaturesModalOptions" class="modal-options-container"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="relatedFeaturesModalConfirm">
                        <i class="bi bi-check-lg me-1"></i>Confirm Selection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://yuldyoshjovfgvgwvbar.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl1bGR5b3Noam92Zmd2Z3d2YmFyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQxNjIyMzEsImV4cCI6MjA3OTczODIzMX0._-QXbx-1xdnCnWlK8i7AgICLUL1-rQii9EUVwIdu04g';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
    </script>
    <script>
        // Variável global para armazenar features carregadas do JSON
        let featuresGrouped = {};
        let featuresList = [];
        
        // Flag para prevenir múltiplos envios
        let isSubmitting = false;

        // Função para carregar features do JSON
        async function loadFeatures() {
            try {
                const response = await fetch('data/features.json');
                if (!response.ok) {
                    throw new Error('Failed to load features.json');
                }
                featuresGrouped = await response.json();
                featuresList = Object.values(featuresGrouped).flat();
                return featuresGrouped;
            } catch (error) {
                console.error('Erro ao carregar features.json:', error);
                // Fallback para objeto vazio em caso de erro
                featuresGrouped = {};
                featuresList = [];
                return featuresGrouped;
            }
        }

        document.addEventListener('DOMContentLoaded', async function () {
            // Carregar features do JSON antes de inicializar
            await loadFeatures();
            // Inicializar tooltips do Bootstrap 5
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // --- Validação de Serviços por País ---
            // Mapeamento de países para serviços disponíveis
            const countryServiceMap = {
                'AR': ['NextSolutions', 'LênioLabs', 'BackOffice'], // Argentina: apenas NextSolutions
                'LT': ['SunDevs', 'LênioLabs', 'BackOffice'],      // Outros países: SunDevs
                'BO': ['SunDevs', 'LênioLabs', 'BackOffice'],
                'CL': ['SunDevs', 'LênioLabs', 'BackOffice'],
                'PE': ['SunDevs', 'LênioLabs', 'BackOffice'],
                'PY': ['SunDevs', 'LênioLabs', 'BackOffice']
            };

            // Função para atualizar serviços disponíveis baseado nos países selecionados
            function atualizarServicosDisponiveis() {
                const selectedCountries = Array.from(document.querySelectorAll('input[name="country"]:checked')).map(cb => cb.value);
                
                // Se nenhum país estiver selecionado, desabilitar todos os serviços
                if (selectedCountries.length === 0) {
                    document.querySelectorAll('input[name="demandSource"]').forEach(service => {
                        service.disabled = true;
                        service.checked = false;
                        const label = document.querySelector(`label[for="${service.id}"]`);
                        if (label) {
                            label.classList.add('opacity-50');
                            label.style.cursor = 'not-allowed';
                        }
                    });
                    return;
                }

                // Calcular interseção de serviços disponíveis para todos os países selecionados
                let availableServices = null;
                selectedCountries.forEach(country => {
                    const servicesForCountry = countryServiceMap[country] || [];
                    if (availableServices === null) {
                        availableServices = new Set(servicesForCountry);
                    } else {
                        // Interseção: manter apenas serviços que estão disponíveis em todos os países selecionados
                        availableServices = new Set([...availableServices].filter(s => servicesForCountry.includes(s)));
                    }
                });

                // Atualizar estado de cada serviço
                document.querySelectorAll('input[name="demandSource"]').forEach(service => {
                    const isAvailable = availableServices.has(service.value);
                    service.disabled = !isAvailable;
                    
                    // Se o serviço não está mais disponível e estava selecionado, desmarcá-lo
                    if (!isAvailable && service.checked) {
                        service.checked = false;
                    }
                    
                    const label = document.querySelector(`label[for="${service.id}"]`);
                    if (label) {
                        if (isAvailable) {
                            label.classList.remove('opacity-50');
                            label.style.cursor = 'pointer';
                        } else {
                            label.classList.add('opacity-50');
                            label.style.cursor = 'not-allowed';
                        }
                    }
                });
            }

            // Adicionar event listeners nos checkboxes de países
            document.querySelectorAll('input[name="country"]').forEach(countryCheckbox => {
                countryCheckbox.addEventListener('change', atualizarServicosDisponiveis);
            });

            // Inicializar: desabilitar todos os serviços até que um país seja selecionado
            atualizarServicosDisponiveis();

            // --- Seleção principal (single) ---
            let selectedFeature = '';
            function renderFeatureModalOptions(filter = '') {
                const container = document.getElementById('featureModalOptions');
                container.innerHTML = '';

                let hasResults = false;

                // Iterar sobre os grupos
                Object.entries(featuresGrouped).forEach(([groupName, features]) => {
                    // Filtrar features do grupo
                    const filtered = features.filter(f => f.toLowerCase().includes(filter.toLowerCase()));

                    if (filtered.length === 0) return;

                    hasResults = true;

                    // Criar cabeçalho do grupo
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'fw-bold text-primary mt-3 mb-2 px-2 py-1 feature-group-header';
                    groupHeader.textContent = groupName;
                    container.appendChild(groupHeader);

                    // Criar features do grupo
                    filtered.forEach((feature, idx) => {
                        const id = 'feature-modal-single-' + groupName.replace(/\s+/g, '-') + '-' + idx;
                        const div = document.createElement('div');
                        div.className = 'form-check border-bottom feature-item';
                        const input = document.createElement('input');
                        input.type = 'radio';
                        input.className = 'form-check-input feature-input';
                        input.name = 'featureModalRadio';
                        input.id = id;
                        input.value = feature;
                        input.checked = selectedFeature === feature;
                        input.addEventListener('change', function () {
                            selectedFeature = this.value;
                        });
                        const label = document.createElement('label');
                        label.className = 'form-check-label feature-label';
                        label.setAttribute('for', id);
                        label.textContent = feature;
                        div.appendChild(input);
                        div.appendChild(label);
                        container.appendChild(div);
                    });
                });

                if (!hasResults) {
                    container.innerHTML = '<p class="text-muted text-center py-3">No features found.</p>';
                }
            }
            document.getElementById('featureModal').addEventListener('show.bs.modal', function () {
                document.getElementById('featureModalSearch').value = '';
                renderFeatureModalOptions();
            });
            document.getElementById('featureModalSearch').addEventListener('input', function () {
                renderFeatureModalOptions(this.value);
            });
            document.getElementById('featureModalConfirm').addEventListener('click', function () {
                document.getElementById('featureSelectedValue').value = selectedFeature;
                document.getElementById('featureSelectedDisplay').innerHTML = selectedFeature ? `<span class="badge bg-primary">${selectedFeature}</span>` : '<span class="text-muted">Select one feature...</span>';
                bootstrap.Modal.getInstance(document.getElementById('featureModal')).hide();
            });

            // --- Seleção relacionadas (multi) ---
            let selectedRelatedFeatures = [];
            function renderRelatedFeaturesModalOptions(filter = '') {
                const container = document.getElementById('relatedFeaturesModalOptions');
                container.innerHTML = '';

                let hasResults = false;

                // Iterar sobre os grupos
                Object.entries(featuresGrouped).forEach(([groupName, features]) => {
                    // Filtrar features do grupo
                    const filtered = features.filter(f => f.toLowerCase().includes(filter.toLowerCase()));

                    if (filtered.length === 0) return;

                    hasResults = true;

                    // Criar cabeçalho do grupo
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'fw-bold text-primary mt-3 mb-2 px-2 py-1 feature-group-header';
                    groupHeader.textContent = groupName;
                    container.appendChild(groupHeader);

                    // Criar features do grupo
                    filtered.forEach((feature, idx) => {
                        const id = 'related-feature-modal-' + groupName.replace(/\s+/g, '-') + '-' + idx;
                        const div = document.createElement('div');
                        div.className = 'form-check border-bottom feature-item';
                        const input = document.createElement('input');
                        input.type = 'checkbox';
                        input.className = 'form-check-input feature-input';
                        input.id = id;
                        input.value = feature;
                        input.checked = selectedRelatedFeatures.includes(feature);
                        input.addEventListener('change', function () {
                            if (this.checked) {
                                if (!selectedRelatedFeatures.includes(feature)) selectedRelatedFeatures.push(feature);
                            } else {
                                selectedRelatedFeatures = selectedRelatedFeatures.filter(f => f !== feature);
                            }
                        });
                        const label = document.createElement('label');
                        label.className = 'form-check-label feature-label';
                        label.setAttribute('for', id);
                        label.textContent = feature;
                        div.appendChild(input);
                        div.appendChild(label);
                        container.appendChild(div);
                    });
                });

                if (!hasResults) {
                    container.innerHTML = '<p class="text-muted text-center py-3">No features found.</p>';
                }
            }
            document.getElementById('relatedFeaturesModal').addEventListener('show.bs.modal', function () {
                document.getElementById('relatedFeaturesModalSearch').value = '';
                renderRelatedFeaturesModalOptions();
            });
            document.getElementById('relatedFeaturesModalSearch').addEventListener('input', function () {
                renderRelatedFeaturesModalOptions(this.value);
            });
            document.getElementById('relatedFeaturesModalConfirm').addEventListener('click', function () {
                document.getElementById('relatedFeaturesSelectedValues').value = selectedRelatedFeatures.join(', ');
                document.getElementById('relatedFeaturesSelectedDisplay').innerHTML = selectedRelatedFeatures.length > 0 ? selectedRelatedFeatures.map(f => `<span class="badge bg-secondary me-1 mb-1">${f}</span>`).join('') : '<span class="text-muted">Select related features...</span>';
                bootstrap.Modal.getInstance(document.getElementById('relatedFeaturesModal')).hide();
            });

            // Controlar switch do prodRepro
            const prodReproSwitch = document.getElementById('prodRepro');
            const prodReproLabel = document.getElementById('prodReproLabel');
            prodReproSwitch.addEventListener('change', function () {
                prodReproLabel.textContent = this.checked ? 'Yes' : 'No';
            });

            // Controlar switch do backendDocAvailable
            const backendDocAvailableSwitch = document.getElementById('backendDocAvailable');
            const backendDocAvailableLabel = document.getElementById('backendDocAvailableLabel');
            const backendDocUrlContainer = document.getElementById('backendDocUrlContainer');
            const backendDocUrlInput = document.getElementById('backendDocUrl');

            backendDocAvailableSwitch.addEventListener('change', function () {
                backendDocAvailableLabel.textContent = this.checked ? 'Yes' : 'No';
                if (this.checked) {
                    backendDocUrlContainer.style.display = 'block';
                    backendDocUrlInput.setAttribute('required', 'required');
                } else {
                    backendDocUrlContainer.style.display = 'none';
                    backendDocUrlInput.removeAttribute('required');
                    backendDocUrlInput.value = '';
                }
            });

            // Controlar switch do presidentApproval
            const presidentApprovalSwitch = document.getElementById('presidentApproval');
            const presidentApprovalLabel = document.getElementById('presidentApprovalLabel');
            const presidentApprovalMessage = document.getElementById('presidentApprovalMessage');

            presidentApprovalSwitch.addEventListener('change', function () {
                presidentApprovalLabel.textContent = this.checked ? 'Yes' : 'No';
                if (!this.checked) {
                    presidentApprovalMessage.style.display = 'block';
                } else {
                    presidentApprovalMessage.style.display = 'none';
                }
            });

            // Função para aplicar tema
            function aplicarTema(mostrarBug) {
                if (mostrarBug) {
                    document.body.classList.remove('theme-us');
                    document.body.classList.add('theme-bug');
                } else {
                    document.body.classList.remove('theme-bug');
                    document.body.classList.add('theme-us');
                }
            }

            // Alterna campos do formulário conforme tipo de work item com animação
            function alternarSecoes(mostrarBug) {
                const bugFields = document.getElementById('bugFields');
                const userStoryFields = document.getElementById('userStoryFields');
                const accordionItemBug = document.getElementById('accordionItemBug');
                const accordionItemUserStory = document.getElementById('accordionItemUserStory');
                const collapseBugEl = document.getElementById('collapseBug');
                const collapseUserStoryEl = document.getElementById('collapseUserStory');
                const collapseInfoBasicasEl = document.getElementById('collapseInfoBasicas');

                // Aplicar tema
                aplicarTema(mostrarBug);

                if (mostrarBug) {
                    // Ocultar User Story primeiro
                    accordionItemUserStory.style.display = 'none';
                    let collapseUserStory = bootstrap.Collapse.getInstance(collapseUserStoryEl);
                    if (collapseUserStory) {
                        collapseUserStory.hide();
                    }
                    userStoryFields.style.display = 'none';

                    // Mostrar Bug ANTES de criar a instância do Collapse
                    accordionItemBug.style.display = 'block';
                    bugFields.style.display = 'block';

                    // Aguardar um frame para o DOM atualizar
                    setTimeout(() => {
                        // Colapsar Informações Básicas
                        let collapseInfoBasicas = bootstrap.Collapse.getInstance(collapseInfoBasicasEl);
                        if (!collapseInfoBasicas) {
                            collapseInfoBasicas = new bootstrap.Collapse(collapseInfoBasicasEl, { toggle: false });
                        }
                        collapseInfoBasicas.hide();

                        // Expandir Bug
                        let collapseBug = bootstrap.Collapse.getInstance(collapseBugEl);
                        if (!collapseBug) {
                            collapseBug = new bootstrap.Collapse(collapseBugEl, { toggle: false });
                        }
                        collapseBug.show();

                        // Scroll suave para o accordion de Bug
                        setTimeout(() => {
                            accordionItemBug.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }, 350);
                    }, 100);
                } else {
                    // Ocultar Bug primeiro
                    accordionItemBug.style.display = 'none';
                    let collapseBug = bootstrap.Collapse.getInstance(collapseBugEl);
                    if (collapseBug) {
                        collapseBug.hide();
                    }
                    bugFields.style.display = 'none';

                    // Mostrar User Story ANTES de criar a instância do Collapse
                    accordionItemUserStory.style.display = 'block';
                    userStoryFields.style.display = 'block';

                    // Aguardar um frame para o DOM atualizar
                    setTimeout(() => {
                        // Colapsar Informações Básicas
                        let collapseInfoBasicas = bootstrap.Collapse.getInstance(collapseInfoBasicasEl);
                        if (!collapseInfoBasicas) {
                            collapseInfoBasicas = new bootstrap.Collapse(collapseInfoBasicasEl, { toggle: false });
                        }
                        collapseInfoBasicas.hide();

                        // Expandir User Story
                        let collapseUserStory = bootstrap.Collapse.getInstance(collapseUserStoryEl);
                        if (!collapseUserStory) {
                            collapseUserStory = new bootstrap.Collapse(collapseUserStoryEl, { toggle: false });
                        }
                        collapseUserStory.show();

                        // Scroll suave para o accordion de User Story
                        setTimeout(() => {
                            accordionItemUserStory.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }, 350);
                    }, 100);
                }
            }

            // Mostrar campos baseado no Work Item selecionado
            document.getElementById('BUG').addEventListener('change', function () {
                if (this.checked) {
                    alternarSecoes(true);
                }
            });

            document.getElementById('UserStory').addEventListener('change', function () {
                if (this.checked) {
                    alternarSecoes(false);
                }
            });

            // Inicializar accordions - ambos ocultos inicialmente, aparecerão ao selecionar Work Item
            const accordionItemBug = document.getElementById('accordionItemBug');
            const accordionItemUserStory = document.getElementById('accordionItemUserStory');
            accordionItemBug.style.display = 'none';
            accordionItemUserStory.style.display = 'none';

            // Não aplicar tema inicial - aguardar seleção do usuário

            // Função para remover destaques de campos pendentes
            function removerDestaquesPendentes() {
                document.querySelectorAll('.campo-pendente').forEach(el => {
                    el.classList.remove('campo-pendente');
                });
                document.querySelectorAll('.campo-pendente-label').forEach(el => {
                    el.classList.remove('campo-pendente-label');
                });
                document.getElementById('pendenciasBox').classList.remove('show');
            }

            // Função de validação completa que retorna lista de pendências
            function validarFormularioCompleto() {
                const pendencias = [];

                // Remover destaques anteriores
                removerDestaquesPendentes();

                // Coletar dados básicos
                const nome = document.getElementById('nome').value.trim();
                const titulo = document.getElementById('titulo').value.trim();

                // Coletar novos campos
                const demandSources = Array.from(document.querySelectorAll('input[name="demandSource"]:checked')).map(i => i.value);
                const demandSourceStr = demandSources.join(', ');
                const backendDocAvailable = document.getElementById('backendDocAvailable').checked;
                const backendDocUrl = document.getElementById('backendDocUrl').value.trim();

                // Coletar countries
                const countries = Array.from(document.querySelectorAll('input[name="country"]:checked')).map(i => i.value || i.id);
                const countryStr = countries.join(', ');

                // Coletar feature principal
                const feature = document.getElementById('featureSelectedValue').value || '';
                // Coletar features relacionadas
                const relatedFeaturesRaw = document.getElementById('relatedFeaturesSelectedValues').value || '';
                
                // Função para agrupar features relacionadas por grupo
                function formatRelatedFeaturesByGroup(featuresStr) {
                    if (!featuresStr || featuresStr.trim() === '') return '';
                    
                    const featuresList = featuresStr.split(', ').map(f => f.trim()).filter(f => f);
                    if (featuresList.length === 0) return '';
                    
                    // Agrupar features por grupo
                    const grouped = {};
                    Object.entries(featuresGrouped).forEach(([groupName, groupFeatures]) => {
                        const matchingFeatures = featuresList.filter(f => groupFeatures.includes(f));
                        if (matchingFeatures.length > 0) {
                            grouped[groupName] = matchingFeatures;
                        }
                    });
                    
                    // Formatar como "Group(feature1, feature2, etc...)"
                    const formattedGroups = Object.entries(grouped).map(([groupName, features]) => {
                        return `${groupName}(${features.join(', ')})`;
                    });
                    
                    return formattedGroups.join('\n');
                }
                
                const relatedFeatures = formatRelatedFeaturesByGroup(relatedFeaturesRaw);

                // Validar campos obrigatórios básicos
                if (demandSources.length === 0) {
                    pendencias.push('Will this demand be returned directly by the service or come from Backoffice?');
                    document.querySelector('label[for="demandSource"]')?.classList.add('campo-pendente-label');
                }
                if (backendDocAvailable && !backendDocUrl) {
                    pendencias.push('Enter URL/Link to document (Azure Wiki or other)');
                    document.getElementById('backendDocUrl').classList.add('campo-pendente');
                    document.querySelector('label[for="backendDocUrl"]')?.classList.add('campo-pendente-label');
                }
                if (!nome) {
                    pendencias.push('Requester');
                    document.getElementById('nome').classList.add('campo-pendente');
                    document.querySelector('label[for="nome"]')?.classList.add('campo-pendente-label');
                }
                if (!titulo) {
                    pendencias.push('Title');
                    document.getElementById('titulo').classList.add('campo-pendente');
                    document.querySelector('label[for="titulo"]')?.classList.add('campo-pendente-label');
                }
                if (countries.length === 0) {
                    pendencias.push('Select country');
                    document.querySelector('label[for="country"]')?.classList.add('campo-pendente-label');
                }
                if (!feature) {
                    pendencias.push('Select Feature/Page');
                    document.querySelector('label[for="featureModalBtn"]')?.classList.add('campo-pendente-label');
                    document.getElementById('featureModalBtn')?.classList.add('campo-pendente');
                }

                // Verificar Work Item
                const workitemEl = document.querySelector('input[name="workitem"]:checked');
                if (!workitemEl) {
                    pendencias.push('Select Work Item');
                    return pendencias;
                }
                const workitem = workitemEl.id;

                // Formatação da data
                const dataAtual = new Date();
                const dataFormatada = dataAtual.toLocaleString('pt-BR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });

                let formatted = '';

                if (workitem === 'BUG') {
                    // Campos de BUG
                    const demandSources = Array.from(document.querySelectorAll('input[name="demandSource"]:checked')).map(i => i.value);
                    const demandSource = demandSources.join(', ');
                    const backendDocAvailable = document.getElementById('backendDocAvailable').checked;
                    const backendDocUrl = document.getElementById('backendDocUrl').value.trim();

                    const env = Array.from(document.querySelectorAll('input[name="env"]:checked')).map(i => i.value || i.id);
                    const envStr = env.join(', ');
                    const prodRepro = document.getElementById('prodRepro').checked ? '✓Yes' : '✘No';
                    const breakpoint = Array.from(document.querySelectorAll('input[name="breakpoint"]:checked')).map(i => i.id).join(', ') || '';
                    const cine = document.getElementById('cine').value.trim() || '';
                    const context = document.getElementById('context').value.trim();
                    const reproSteps = document.getElementById('reproSteps').value.trim();
                    const user = document.getElementById('user').value.trim();
                    const password = document.getElementById('password').value.trim();
                    const userType = Array.from(document.querySelectorAll('input[name="userType"]:checked')).map(i => i.labels && i.labels.length > 0 ? i.labels[0].innerText.trim() : (i.value || i.id));
                    const userTypeStr = userType.join(', ');
                    const businessRule = document.getElementById('businessRule').value.trim();
                    const linkFigma = document.getElementById('linkFigma').value.trim() || '';


                    // Validação de campos obrigatórios BUG
                    if (env.length === 0) {
                        pendencias.push('Select environment');
                        document.querySelector('label[for="env"]')?.classList.add('campo-pendente-label');
                    }
                    if (!context) {
                        pendencias.push('Context');
                        document.getElementById('context').classList.add('campo-pendente');
                        document.querySelector('label[for="context"]')?.classList.add('campo-pendente-label');
                    }
                    if (!reproSteps) {
                        pendencias.push('Repro Steps to reproduction');
                        document.getElementById('reproSteps').classList.add('campo-pendente');
                        document.querySelector('label[for="reproSteps"]')?.classList.add('campo-pendente-label');
                    }
                    if (!user) {
                        pendencias.push('User');
                        document.getElementById('user').classList.add('campo-pendente');
                        document.querySelector('label[for="user"]')?.classList.add('campo-pendente-label');
                    }
                    if (!password) {
                        pendencias.push('Password');
                        document.getElementById('password').classList.add('campo-pendente');
                        document.querySelector('label[for="password"]')?.classList.add('campo-pendente-label');
                    }
                    if (userType.length === 0) {
                        pendencias.push('Select User type');
                        document.querySelector('label[for="userType"]')?.classList.add('campo-pendente-label');
                    }
                    if (!businessRule) {
                        pendencias.push('Business rule And expected solution');
                        document.getElementById('businessRule').classList.add('campo-pendente');
                        document.querySelector('label[for="businessRule"]')?.classList.add('campo-pendente-label');
                    }

                    // Se houver pendências, retornar
                    if (pendencias.length > 0) {
                        return pendencias;
                    }

                    // Formato de texto simples conforme especificado
                    formatted = `[${feature}] ${titulo}
𝗖𝗢𝗨𝗡𝗧𝗥𝗬: ${countryStr}
𝗪𝗢𝗥𝗞 𝗜𝗧𝗘𝗠: BUG (EXT)
𝗘𝗡𝗩𝗜𝗥𝗢𝗡𝗠𝗘𝗡𝗧: ${envStr}

𝗦𝗘𝗥𝗩𝗜𝗖𝗘 𝗟𝗔𝗬𝗘𝗥: ${demandSource}
${backendDocAvailable ? `𝗕𝗔𝗖𝗞𝗘𝗡𝗗 𝗗𝗢𝗖𝗨𝗠𝗘𝗡𝗧𝗔𝗧𝗜𝗢𝗡:\nAvailable in: ${backendDocUrl}` : '𝗕𝗔𝗖𝗞𝗘𝗡𝗗 𝗗𝗢𝗖𝗨𝗠𝗘𝗡𝗧𝗔𝗧𝗜𝗢𝗡: Not available'}

𝗥𝗘𝗟𝗔𝗧𝗘𝗗 𝗙𝗘𝗔𝗧𝗨𝗥𝗘𝗦/𝗣𝗔𝗚𝗘𝗦:
${relatedFeatures}

𝗜𝗦 𝗣𝗢𝗦𝗦𝗜𝗕𝗟𝗘 𝗥𝗘𝗣𝗥𝗢𝗗𝗨𝗖𝗘 𝗜𝗡 𝗣𝗥𝗢𝗗 𝗘𝗡𝗩𝗜𝗥𝗢𝗠𝗘𝗡: ${prodRepro}

𝗖𝗢𝗡𝗧𝗘𝗫𝗧:
${context}

𝗥𝗘𝗣𝗥𝗢 𝗦𝗧𝗘𝗣𝗦 𝗧𝗢 𝗥𝗘𝗣𝗥𝗢𝗗𝗨𝗖𝗧𝗜𝗢𝗡:
${reproSteps}

𝗕𝗥𝗘𝗔𝗞𝗣𝗢𝗜𝗡𝗧: ${breakpoint}
𝗖𝗜𝗡𝗘: ${cine}
𝗨𝗦𝗘𝗥: ${user}
𝗣𝗔𝗦𝗦𝗪𝗢𝗥𝗗: ${password}
𝗨𝗦𝗘𝗥 𝗧𝗬𝗣𝗘: ${userTypeStr}

𝗕𝗨𝗦𝗜𝗡𝗘𝗦𝗦 𝗥𝗨𝗟𝗘 𝗔𝗡𝗗 𝗘𝗫𝗣𝗘𝗖𝗧𝗘𝗗 𝗦𝗢𝗟𝗨𝗧𝗜𝗢𝗡:
${businessRule}
${linkFigma ? `𝗟𝗜𝗡𝗞 𝗙𝗜𝗚𝗠𝗔 (𝗢𝗣𝗖𝗜𝗢𝗡𝗔𝗟): ${linkFigma}` : ''}


Created by ${nome} on ${dataFormatada}`;
                } else {
                    // Campos de User Story
                    const demandSources = Array.from(document.querySelectorAll('input[name="demandSource"]:checked')).map(i => i.value);
                    const demandSource = demandSources.join(', ');
                    const backendDocAvailable = document.getElementById('backendDocAvailable').checked;
                    const backendDocUrl = document.getElementById('backendDocUrl').value.trim();
                    const presidentApproval = document.getElementById('presidentApproval').checked;

                    const typeDemandEl = document.querySelector('input[name="typeDemand"]:checked');
                    const typeDemandStr = typeDemandEl ? (typeDemandEl.value || typeDemandEl.id) : 'Improvement';
                    const asA = document.getElementById('asA').value.trim();
                    const iWant = document.getElementById('iWant').value.trim();
                    const soThat = document.getElementById('soThat').value.trim();
                    const contextUS = document.getElementById('contextUS').value.trim();
                    const businessRuleUS = document.getElementById('businessRuleUS').value.trim();
                    const criteriosAceite = document.getElementById('criteriosAceite').value.trim();
                    const linkFigmaUS = document.getElementById('linkFigmaUS').value.trim() || '';


                    // Validação de campos obrigatórios User Story
                    if (!typeDemandEl) {
                        pendencias.push('Type of Demand');
                        document.querySelector('label[for="typeDemand"]')?.classList.add('campo-pendente-label');
                    }
                    if (!asA) {
                        pendencias.push('As a...');
                        document.getElementById('asA').classList.add('campo-pendente');
                        document.querySelector('label[for="asA"]')?.classList.add('campo-pendente-label');
                    }
                    if (!iWant) {
                        pendencias.push('I Want...');
                        document.getElementById('iWant').classList.add('campo-pendente');
                        document.querySelector('label[for="iWant"]')?.classList.add('campo-pendente-label');
                    }
                    if (!soThat) {
                        pendencias.push('So that...');
                        document.getElementById('soThat').classList.add('campo-pendente');
                        document.querySelector('label[for="soThat"]')?.classList.add('campo-pendente-label');
                    }
                    if (!contextUS) {
                        pendencias.push('Contextualize your demand');
                        document.getElementById('contextUS').classList.add('campo-pendente');
                        document.querySelector('label[for="contextUS"]')?.classList.add('campo-pendente-label');
                    }
                    if (!businessRuleUS) {
                        pendencias.push('Business rule And expected solution');
                        document.getElementById('businessRuleUS').classList.add('campo-pendente');
                        document.querySelector('label[for="businessRuleUS"]')?.classList.add('campo-pendente-label');
                    }
                    if (!criteriosAceite) {
                        pendencias.push('Acceptance Criteria');
                        document.getElementById('criteriosAceite').classList.add('campo-pendente');
                        document.querySelector('label[for="criteriosAceite"]')?.classList.add('campo-pendente-label');
                    }

                    // Se houver pendências, retornar
                    if (pendencias.length > 0) {
                        return pendencias;
                    }

                    // Formato de texto simples conforme especificado
                    formatted = `[${feature}] ${titulo}
𝗖𝗢𝗨𝗡𝗧𝗥𝗬: ${countryStr}

𝗪𝗢𝗥𝗞 𝗜𝗧𝗘𝗠: USER STORY
𝗦𝗘𝗥𝗩𝗜𝗖𝗘 𝗟𝗔𝗬𝗘𝗥: ${demandSource}
${backendDocAvailable ? `𝗕𝗔𝗖𝗸𝗘𝗡𝗗 𝗗𝗢𝗖𝗨𝗠𝗘𝗡𝗧𝗔𝗧𝗜𝗢𝗡: Available\n𝗗𝗢𝗖𝗨𝗠𝗘𝗡𝗧𝗔𝗧𝗜𝗢𝗡 𝗨𝗥𝗟: ${backendDocUrl}` : '𝗕𝗔𝗖𝗞𝗘𝗡𝗗 𝗗𝗢𝗖𝗨𝗠𝗘𝗡𝗧𝗔𝗧𝗜𝗢𝗡: Not available'}
${presidentApproval ? '𝗠𝗞𝗧 𝗢𝗥 𝗠𝗔𝗡𝗔𝗚𝗘𝗥 𝗔𝗟𝗥𝗘𝗔𝗗𝗬 𝗔𝗣𝗣𝗥𝗢𝗩𝗘𝗗: Approved' : '/𝗠𝗞𝗧 𝗢𝗥 𝗠𝗔𝗡𝗔𝗚𝗘𝗥 𝗔𝗟𝗥𝗘𝗔𝗗𝗬 𝗔𝗣𝗣𝗥𝗢𝗩𝗘𝗗: Pending'}

𝗥𝗘𝗟𝗔𝗧𝗘𝗗 𝗙𝗘𝗔𝗧𝗨𝗥𝗘𝗦/𝗣𝗔𝗚𝗘𝗦:
${relatedFeatures}

𝗧𝗬𝗣𝗘 𝗗𝗘𝗠𝗔𝗡𝗗: ${typeDemandStr}

𝗔𝗦 𝗔: ${asA}
𝗜 𝗪𝗔𝗡𝗧: ${iWant}
𝗦𝗢 𝗧𝗛𝗔𝗧: ${soThat}

𝗖𝗢𝗡𝗧𝗘𝗫𝗧:
${contextUS}

𝗕𝗨𝗦𝗜𝗡𝗘𝗦𝗦 𝗥𝗨𝗟𝗘 𝗔𝗡𝗗 𝗘𝗫𝗣𝗘𝗖𝗧𝗘𝗗 𝗦𝗢𝗟𝗨𝗧𝗜𝗢𝗡:
${businessRuleUS}
${linkFigmaUS ? `𝗟𝗜𝗡𝗞 𝗙𝗜𝗚𝗠𝗔 (𝗢𝗣𝗖𝗜𝗢𝗡𝗔𝗟): ${linkFigmaUS}` : ''}

𝗔𝗖𝗖𝗘𝗣𝗧𝗔𝗡𝗖𝗘 𝗖𝗥𝗜𝗧𝗘𝗥𝗜𝗔:
${criteriosAceite}


Created by ${nome} on ${dataFormatada}`;
                }

                // Exibir resultado formatado
                const resultadoDiv = document.getElementById('resultadoDiv');
                const resultadoTextarea = document.getElementById('resultado');
                resultadoTextarea.value = formatted;

                // Mostrar seção de resultado
                const accordionItemResultado = document.getElementById('accordionItemResultado');
                const collapseResultadoEl = document.getElementById('collapseResultado');
                accordionItemResultado.style.display = 'block';

                // Colapsar etapas anteriores
                const collapseBug = bootstrap.Collapse.getInstance(document.getElementById('collapseBug'));
                const collapseUserStory = bootstrap.Collapse.getInstance(document.getElementById('collapseUserStory'));
                if (collapseBug) collapseBug.hide();
                if (collapseUserStory) collapseUserStory.hide();

                // Aguardar um pouco para garantir que o DOM atualizou
                setTimeout(() => {
                    // Expandir o accordion de resultado
                    let collapseResultado = bootstrap.Collapse.getInstance(collapseResultadoEl);
                    if (!collapseResultado) {
                        collapseResultado = new bootstrap.Collapse(collapseResultadoEl, {
                            toggle: false
                        });
                    }

                    // Forçar exibição do conteúdo
                    collapseResultadoEl.classList.add('show');
                    collapseResultadoEl.style.display = 'block';

                    // Expandir
                    collapseResultado.show();

                    // Scroll suave até o resultado
                    setTimeout(() => {
                        accordionItemResultado.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }, 350);
                }, 150);

                return pendencias;
            }

            // Event listener para o formulário
            document.getElementById('formulario').addEventListener('submit', function (e) {
                e.preventDefault();

                // Prevenir múltiplos envios
                if (isSubmitting) {
                    console.log('⚠️ Formulário já está sendo processado, ignorando submissão...');
                    return;
                }

                const pendencias = validarFormularioCompleto();

                if (pendencias.length > 0) {
                    // Mostrar lista de pendências
                    const pendenciasBox = document.getElementById('pendenciasBox');
                    const pendenciasLista = document.getElementById('pendenciasLista');
                    pendenciasLista.innerHTML = '';
                    pendencias.forEach(pendencia => {
                        const li = document.createElement('li');
                        li.textContent = pendencia;
                        pendenciasLista.appendChild(li);
                    });
                    pendenciasBox.classList.add('show');

                    // Scroll para o primeiro campo pendente (já destacado pela função de validação)
                    setTimeout(() => {
                        const primeiroCampoPendente = document.querySelector('.campo-pendente, .campo-pendente-label');
                        if (primeiroCampoPendente) {
                            primeiroCampoPendente.scrollIntoView({
                                behavior: 'smooth',
                                block: 'center'
                            });
                        }
                    }, 100);
                } else {
                    // Se não houver pendências, o resultado já foi gerado na função
                    document.getElementById('pendenciasBox').classList.remove('show');

                    // Marcar como enviando
                    isSubmitting = true;
                    
                    // Desabilitar botão para prevenir múltiplos cliques
                    const gerarButton = document.getElementById('gerarButton');
                    gerarButton.disabled = true;
                    gerarButton.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Sending...';

                    // Obter tipo de work item
                    const workitemEl = document.querySelector('input[name="workitem"]:checked');
                    const workitemType = workitemEl ? workitemEl.id : '';
                    const resultado = document.getElementById('resultado').value;

                    console.log('📋 Formulário submetido com sucesso!', {
                        workitemType,
                        resultadoLength: resultado?.length,
                        resultadoPreview: resultado?.substring(0, 100) + '...'
                    });

                    // Enviar notificação ao Slack
                    if (workitemType && resultado) {
                        notificarSlack(workitemType, resultado);
                    } else {
                        console.error('❌ Dados incompletos para enviar ao Slack:', { workitemType, resultado: !!resultado });
                        // Reabilitar botão em caso de erro
                        isSubmitting = false;
                        gerarButton.disabled = false;
                        gerarButton.innerHTML = '<i class="bi bi-hammer me-2"></i>Generate Work Item';
                    }
                }
            });

            // Função para notificar o Slack usando Supabase Edge Function (resolve CORS)
            async function notificarSlack(workitemType, formattedText) {
                console.log('🔔 Função notificarSlack chamada', { workitemType, formattedTextLength: formattedText?.length });

                if (!formattedText || formattedText.trim() === '') {
                    console.error('❌ Texto formatado está vazio!');
                    return;
                }

                if (!workitemType) {
                    console.error('❌ Tipo de work item não definido!');
                    return;
                }

                try {
                    const titulo = document.getElementById('titulo').value.trim();
                    const nome = document.getElementById('nome').value.trim();

                    // Determinar emoji e cor baseado no tipo
                    let emoji = '📋';
                    let typeLabel = 'USER STORY';
                    if (workitemType === 'BUG') {
                        emoji = '🐞';
                        typeLabel = 'BUG';
                    } else {
                        emoji = '🎯';
                        typeLabel = 'USER STORY';
                    }


                    console.log('📝 Dados preparados:', { titulo, nome, typeLabel });

                    // Formato simplificado para Slack
                    const slackMessageText = `${emoji} *New ${typeLabel} reported by the client.*\n*Title:* ${titulo}\n*Created by:* ${nome}\n\n\`\`\`${formattedText}\`\`\``;

                    console.log('📤 Enviando mensagem via Supabase Edge Function...');

                    // Chamar Edge Function do Supabase para enviar ao Slack (resolve CORS)
                    const { data, error } = await supabase.functions.invoke('notify-slack', {
                        body: {
                            message: slackMessageText,
                            channel: 'cli-demand-notification'
                        }
                    });

                    if (error) {
                        console.error('❌ Erro ao chamar Edge Function:', error);
                        console.error('📋 Detalhes do erro:', JSON.stringify(error, null, 2));
                        alert(`Erro ao enviar notificação ao Slack.\n\nErro: ${error.message || JSON.stringify(error)}\n\nVerifique o console (F12) para mais detalhes.`);
                        // Reabilitar botão em caso de erro
                        isSubmitting = false;
                        const gerarButton = document.getElementById('gerarButton');
                        gerarButton.disabled = false;
                        gerarButton.innerHTML = '<i class="bi bi-hammer me-2"></i>Generate Work Item';
                        return;
                    }

                    console.log('📬 Resposta da Edge Function:', data);

                    if (data) {
                        if (data.success || data.message || !data.error) {
                            console.log('✅ Notificação enviada ao Slack com sucesso!', data);
                            mostrarAlertaSucesso();
                        } else if (data.error) {
                            console.error('❌ Erro na resposta da Edge Function:', data.error);
                            alert(`Erro ao enviar notificação: ${data.error}\n\nVerifique o console para mais detalhes.`);
                        } else {
                            // Mesmo sem confirmação explícita, tentar mostrar sucesso
                            console.log('⚠️ Resposta sem confirmação explícita, assumindo sucesso:', data);
                            mostrarAlertaSucesso();
                        }
                    } else {
                        console.warn('⚠️ Resposta vazia da Edge Function, mas sem erro. Assumindo sucesso.');
                        mostrarAlertaSucesso();
                    }
                } catch (error) {
                    console.error('❌ Erro ao enviar notificação ao Slack:', error);
                    console.error('📋 Stack trace:', error.stack);
                    alert(`Erro ao enviar notificação ao Slack.\n\nErro: ${error.message}\n\nVerifique o console (F12) para mais detalhes.`);
                }
            }

            function mostrarAlertaSucesso() {
                const alertCopiado = document.querySelector('.alert-copiado');
                const originalText = alertCopiado.innerHTML;
                alertCopiado.innerHTML = '<i class="bi bi-slack me-2"></i>Notification sent to Slack channel!';
                alertCopiado.classList.remove('alert-danger');
                alertCopiado.classList.add('alert-success');
                alertCopiado.style.display = 'block';
                setTimeout(() => {
                    alertCopiado.innerHTML = originalText;
                    alertCopiado.style.display = 'none';
                }, 4000);
                
                // Esconder botão Generate e mostrar botão Clear
                const gerarButton = document.getElementById('gerarButton');
                const clearButton = document.getElementById('clearButton');
                gerarButton.style.display = 'none';
                clearButton.style.display = 'inline-block';
            }
            
            // Função para limpar o formulário completamente
            function limparFormulario() {
                // Resetar flag
                isSubmitting = false;
                
                // Resetar formulário
                document.getElementById('formulario').reset();
                
                // Limpar seleções de features
                selectedFeature = '';
                selectedRelatedFeatures = [];
                document.getElementById('featureSelectedValue').value = '';
                document.getElementById('featureSelectedDisplay').innerHTML = '<span class="text-muted">Select one feature...</span>';
                document.getElementById('relatedFeaturesSelectedValues').value = '';
                document.getElementById('relatedFeaturesSelectedDisplay').innerHTML = '<span class="text-muted">Select related features...</span>';
                
                // Limpar work item selection
                document.querySelectorAll('input[name="workitem"]').forEach(radio => radio.checked = false);
                
                // Ocultar accordions de Bug e User Story
                document.getElementById('accordionItemBug').style.display = 'none';
                document.getElementById('accordionItemUserStory').style.display = 'none';
                document.getElementById('accordionItemResultado').style.display = 'none';
                
                // Expandir apenas o Step 1
                const collapseInfoBasicas = bootstrap.Collapse.getInstance(document.getElementById('collapseInfoBasicas'));
                if (collapseInfoBasicas) {
                    collapseInfoBasicas.show();
                }
                
                // Limpar resultado
                document.getElementById('resultado').value = '';
                
                // Remover destaques de campos pendentes
                removerDestaquesPendentes();
                
                // Remover classes de tema
                document.body.classList.remove('theme-bug', 'theme-us');
                
                // Mostrar botão Generate e esconder Clear
                const gerarButton = document.getElementById('gerarButton');
                const clearButton = document.getElementById('clearButton');
                gerarButton.style.display = 'inline-block';
                gerarButton.disabled = false;
                gerarButton.innerHTML = '<i class="bi bi-hammer me-2"></i>Generate Work Item';
                clearButton.style.display = 'none';
                
                // Atualizar serviços disponíveis após limpar países
                atualizarServicosDisponiveis();
                
                // Scroll para o topo
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
            
            // Event listener para o botão Clear
            document.getElementById('clearButton').addEventListener('click', function() {
                limparFormulario();
            });

            // Event listener para o botão de copiar
            document.getElementById('copyButton').addEventListener('click', function () {
                const resultado = document.getElementById('resultado');
                resultado.select();
                document.execCommand('copy');

                // Mostrar alert de cópia
                const alertCopiado = document.querySelector('.alert-copiado');
                alertCopiado.style.display = 'block';
                setTimeout(() => {
                    alertCopiado.style.display = 'none';
                }, 3000);
            });
        });
    </script>

    <!-- Footer -->
    <footer class="text-center py-3 mt-5" style="color: #6c757d; font-size: 0.875rem;">
        Created by Matheus Bonotto - MB Labs - 2025
    </footer>
</body>

</html>